\section{Preparing for Numerical Model}

Implementing RK4 requires transforming the coupled second-order differential equations derived in Section 2 into a system of first-order differential equations.

\subsection{Matrix Formulation of Motion}
We begin with the coupled Euler-Lagrange equations \eqref{theta1} and \eqref{theta2}. By grouping the angular acceleration terms ($\ddot{\theta}_1, \ddot{\theta}_2$) on the left-hand side and the remaining velocity and potential terms on the right, we obtain the following linear system:

\begin{align}
  (m_1 + m_2) l_1 \ddot{\theta}_1 + m_2 l_2 \cos(\theta_1-\theta_2)\ddot{\theta}_2
  &= -m_2 l_2 \dot{\theta}_2^2 \sin(\theta_1-\theta_2) - (m_1+m_2) g \sin\theta_1, \label{eq:rearr1}\\
  m_2 l_1 \cos(\theta_1-\theta_2)\ddot{\theta}_1 + m_2 l_2 \ddot{\theta}_2
  &= m_2 l_1 \dot{\theta}_1^2 \sin(\theta_1-\theta_2) - m_2 g \sin\theta_2. \label{eq:rearr2}
\end{align}

This system can be written in matrix form as $M(\theta)\ddot{\theta} = b(\theta,\omega)$, where $\omega_i = \dot{\theta}_i$:

\begin{equation*}
\underbrace{
\begin{pmatrix}
(m_1+m_2) l_1 & m_2 l_2 \cos(\theta_1-\theta_2) \\[6pt]
m_2 l_1 \cos(\theta_1-\theta_2) & m_2 l_2
\end{pmatrix}
}_{M(\theta)}
\underbrace{
\begin{pmatrix}
\ddot{\theta}_1 \\[6pt] \ddot{\theta}_2
\end{pmatrix}
}_{\ddot{\theta}}
=
\underbrace{
\begin{pmatrix}
-m_2 l_2 \omega_2^2 \sin(\theta_1-\theta_2) - (m_1+m_2) g \sin\theta_1 \\[6pt]
m_2 l_1 \omega_1^2 \sin(\theta_1-\theta_2) - m_2 g \sin\theta_2
\end{pmatrix}
}_{b(\theta, \omega)}.
\end{equation*}

\subsection{Explicit Acceleration Terms}
To solve for the angular accelerations $\ddot{\theta}$, we invert the mass matrix $M$. For a $2\times2$ matrix, the inverse is explicitly given by:
\[
\ddot{\theta} = M^{-1} b = \frac{1}{\det M}
\begin{pmatrix}
a_{22} & -a_{12} \\[6pt]
-a_{21} & a_{11}
\end{pmatrix}
\begin{pmatrix} b_1 \\[6pt] b_2 \end{pmatrix}.
\]
Defining the angle difference as $\Delta = \theta_1 - \theta_2$, the determinant is $\det M = m_2 l_1 l_2 (m_1 + m_2 \sin^2\Delta)$. Carrying out the matrix multiplication yields the explicit accelerations:

\begin{align}
\ddot{\theta}_1 &= \frac{1}{\det M} \left[ m_2 l_2 b_1 - m_2 l_2 \cos(\Delta) b_2 \right], \label{ddtheta1} \\[8pt]
\ddot{\theta}_2 &= \frac{1}{\det M} \left[ -m_2 l_1 \cos(\Delta) b_1 + (m_1+m_2)l_1 b_2 \right]. \label{ddtheta2}
\end{align}

Substituting the components of vector $b$ (from \eqref{eq:rearr1} and \eqref{eq:rearr2}) into these expressions provides the functions necessary for the numerical solver.

\subsection{State-Space Representation}
Finally, we convert the two second-order equations into a system of four first-order equations. We introduce the state vector $X$:
\[
X = \begin{pmatrix} \theta_1 & \theta_2 & \omega_1 & \omega_2 \end{pmatrix}^T.
\]
The time evolution of the system is governed by $\dot{X} = F(X)$:
\[
\dot{X} =
\frac{d}{dt}
\begin{pmatrix} \theta_1 \\[4pt] \theta_2 \\[4pt] \omega_1 \\[4pt] \omega_2 \end{pmatrix}
=
\begin{pmatrix}
\omega_1 \\[6pt]
\omega_2 \\[6pt]
\ddot{\theta}_1(\theta_1,\theta_2,\omega_1,\omega_2) \\[6pt]
\ddot{\theta}_2(\theta_1,\theta_2,\omega_1,\omega_2)
\end{pmatrix},
\]
where $\ddot{\theta}_1$ and $\ddot{\theta}_2$ are determined by equations \eqref{ddtheta1} and \eqref{ddtheta2}. This vector field $F(X)$ is passed directly to the RK4 algorithm.
